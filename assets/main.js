/** global: wp, CodeMirror */
var pollux={editors:{},media:{featured:{}},metabox:{},tabs:{}};pollux.classListAction=function(e){return e?"add":"remove"},pollux.media.featured.init=function(){jQuery("#postimagediv").on("click","#pollux-set-featured",function(e){e.preventDefault(),wp.media.view.settings.post.featuredImageId=Math.round(jQuery("#featured").val()),pollux.media.featured.frame=wp.media.featuredImage.frame,pollux.media.featured.frame().open()}).on("click","#pollux-remove-featured",function(e){e.preventDefault(),pollux.media.featured.set(-1)})},pollux.media.featured.select=function(){if(wp.media.view.settings.post.featuredImageId){var e=this.get("selection").single();pollux.media.featured.set(e?e.id:-1)}},pollux.media.featured.set=function(e){wp.media.view.settings.post.featuredImageId=Math.round(e),wp.media.post("pollux/archives/featured/html",{_wpnonce:document.querySelector("#_wpnonce").value,post_type:document.querySelector("#archive-type").value,thumbnail_id:e}).done(function(e){document.querySelector("#postimagediv > .inside").innerHTML=e})},pollux.metabox.hasValue=function(e){return"checkbox"===e.type?!0===e.checked:""!==e.value},pollux.metabox.init=function(){var e=document.querySelectorAll(".rwmb-input [data-depends]");[].forEach.call(e,function(e){var t=pollux.metabox.setVisibility(e),l="checkbox"===t.type?"change":"keyup";t.addEventListener(l,function(){pollux.metabox.setVisibility(e)})})},pollux.metabox.setVisibility=function(e){var t=document.getElementById(e.getAttribute("data-depends")),l=pollux.classListAction(!pollux.metabox.hasValue(t));return e.closest(".rwmb-field").classList[l]("hidden"),t},pollux.tabs.init=function(){pollux.tabs.active=document.querySelector("#pollux-active-tab"),pollux.tabs.referrer=document.querySelector('input[name="_wp_http_referer"]'),pollux.tabs.tabs=document.querySelectorAll(".pollux-tabs a"),pollux.tabs.views=document.querySelectorAll(".pollux-config .form-table"),[].forEach.call(pollux.tabs.tabs,function(e,t){(location.hash?e.getAttribute("href").slice(1)===location.hash.slice(2):0===t)&&pollux.tabs.setTab(e),e.addEventListener("click",pollux.tabs.onClick),e.addEventListener("touchend",pollux.tabs.onClick)})},pollux.tabs.onClick=function(e){e.preventDefault(),this.blur(),pollux.tabs.setTab(this),location.hash="!"+this.getAttribute("href").slice(1)},pollux.tabs.setReferrer=function(e){var t=pollux.tabs.referrer.value.split("#")[0]+"#!"+pollux.tabs.views[e].id;pollux.tabs.referrer.value=t},pollux.tabs.setTab=function(e){[].forEach.call(pollux.tabs.tabs,function(t,l){var o=pollux.classListAction(t===e);"add"===o&&(pollux.tabs.active.value=pollux.tabs.views[l].id,pollux.tabs.setReferrer(l),pollux.tabs.setView(l)),t.classList[o]("nav-tab-active")})},pollux.tabs.setView=function(e){[].forEach.call(pollux.tabs.views,function(t,l){var o=pollux.classListAction(l!==e);t.classList[o]("ui-tabs-hide")})},pollux.editors.init=function(){pollux.editors.all=[],[].forEach.call(document.querySelectorAll(".pollux-code"),function(e,t){pollux.editors.all[t]=CodeMirror.fromTextArea(e,{gutters:["CodeMirror-lint-markers"],highlightSelectionMatches:{wordsOnly:!0},lineNumbers:!0,lint:!0,mode:"text/yaml",showInvisibles:!0,showTrailingSpace:!0,styleActiveLine:!0,tabSize:2,theme:"pollux",viewportMargin:1/0}),pollux.editors.all[t].setOption("extraKeys",{Tab:function(e){var t=Array(e.getOption("indentUnit")+1).join(" ");e.replaceSelection(t)}}),pollux.editors.all[t].display.wrapper.setAttribute("data-disabled",e.getAttribute("data-disabled")),e.readOnly&&(pollux.editors.all[t].setOption("theme","disabled"),pollux.editors.all[t].setOption("readOnly","nocursor"))})},jQuery(function(){pollux.editors.init(),pollux.media.featured.init(),pollux.metabox.init(),pollux.tabs.init()});